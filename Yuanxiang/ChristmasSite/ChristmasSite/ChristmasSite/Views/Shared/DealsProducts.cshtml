@using ChristmasSite.Data
@using ChristmasSite.Logic

@model DealsProductsModelData

@{
    DealsProductsModelData data = Model;
}

<div id="filters">
    <div class="popular_category">
        @Html.Raw(data.CategoreSelect)
    </div>

    <div class="input-group inputBox search" id="home-searchbar2" style="position: relative; margin-left: 0px;">
        <input class="form-control home-search-textbox homeBG" type="search" id="SearchTextBox2" placeholder="Search for categories" autocomplete="off" />
        <div class="drop">
            <ul id="categoryDrop" class="list"></ul>
        </div>
    </div>

</div>

<div class="products">
    <div id="catalogBar">
        <div id="sortByDiv" class="sortByDiv">
            <label title="Sort :"><span class="glyphicon glyphicon-sort"></span>&nbsp;</label>
            <select id="sortBySelect">
                @Html.Raw(data.SortByItems)
            </select>
        </div>
    </div>

    <div id="product-grid-view">
        @{
            for (int i = 0; i < data.datas.Count; i++)
            {
                ProductCatalog pc = data.datas[i];

                <div class="product-grid-item">
                    <div class="sale_info"><span>@Html.Raw(Convert.ToInt32(Math.Abs(pc.rate * 100)))% Off</span></div>

                    <a href="@Html.Raw(pc.trackURL)" rel="nofollow" target="_blank">
                        <img src="@Html.Raw(ChristmasSiteController.GetImage(pc.productimages, "ms"))" alt="@Html.Raw(pc.productname)" title="@Html.Raw(pc.productname)" />
                    </a>

                    <div class="middle-div">
                        <a class="productNameLink" href="@Html.Raw(pc.trackURL)" rel="nofollow" target="_blank">@Html.Raw(pc.productname)</a>

                        <div class="bestPPCDiv">
                            <div class="old_price"><span class="priceSymbol">$</span><span class="priceSpan">@Html.Raw(string.Format("{0:n}", Convert.ToDecimal(pc.oldprice)))</span></div>
                            <div class="new_price"><span class="priceSymbol">$</span><span class="priceSpan">@Html.Raw(string.Format("{0:n}", Convert.ToDecimal(pc.newprice)))</span></div>
                        </div>
                    </div>

                    <div class="retailer_logo">
                        <img alt="@Html.Raw(pc.retailername)" src="@Html.Raw(ChristmasSiteController.GetImage(pc.retailerlogo, "ms"))" />
                    </div>
                </div>
            }
        }
    </div>

    <div id="pagerDiv">
        @Html.Raw(data.Pagination)
    </div>
</div>

<script type="text/javascript">

    (function () {
        var searchTextNode = $("#SearchTextBox2");
        var dropNode = $("#home-searchbar2 .drop");


        searchTextNode.on("keyup", function () {
            var str = searchTextNode.val().toLowerCase();

            if (str == "") {
                dropNode.css("display", "none");
                return;
            }

            GlobalAjax("AjaxController", "LoadCategory", { input: str }, function (msg) {

                dropNode.find("#categoryDrop").html(msg);

                dropNode.find("li").each(function () {
                    var node = $(this);
                    node.on("click", function () { document.location.href = node.attr("value"); });
                });

                if (msg != "") dropNode.css("display", "block");
                else dropNode.css("display", "none");
            });

        });

        $("#sortBySelect").on("change", function () {

            var url = $(this).val();

            document.location.href = url;
        });

    })();

</script>